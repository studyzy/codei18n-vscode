# 功能规范：Java 语言系列注释翻译支持

## 新增需求

### 需求：扩展支持 Java 语言的注释翻译

该需求规定 CodeI18n VSCode 扩展必须支持 Java 语言(`.java` 文件)的注释自动翻译,与 Go、Rust、JavaScript、TypeScript 具有相同的功能体验。

**理由**  
- CodeI18n CLI 已经完全支持 Java 语言的注释扫描和翻译
- Java 是企业级开发中最广泛使用的编程语言之一
- 用户期望在阅读 Java 代码库时能够获得注释翻译功能

#### 场景：开发者打开 Java 文件时自动显示注释翻译

**前置条件**:
- CodeI18n 扩展已安装并启用
- 工作区已初始化 CodeI18n 配置(`.codei18n/` 目录存在)
- `codei18n` CLI 工具可用

**操作步骤**:
1. 用户在 VSCode 中打开一个 `.java` 文件
2. 扩展检测到文件语言为 `java`
3. 扩展自动调用 `codei18n scan` 获取注释翻译

**预期结果**:
- Java 文件中的行注释(`//`)和文档注释(`/** */`)被正确识别
- 注释位置显示翻译后的文本(通过 Decoration API)
- 鼠标悬停在翻译文本上时,Hover 显示原始英文注释

**验证方式**:
- 创建包含英文注释的 Java 测试文件
- 在 VSCode 中打开该文件
- 检查输出面板中的 CodeI18n 日志,确认扫描成功
- 验证编辑器中显示翻译文本

#### 场景：开发者编辑 Java 文件时实时更新翻译

**前置条件**:
- Java 文件已打开并显示翻译
- 用户修改或添加新注释

**操作步骤**:
1. 用户在 Java 文件中添加新的注释 `// New comment`
2. 扩展监听到文档变更事件
3. 扩展触发重新扫描(应用去抖逻辑)

**预期结果**:
- 新添加的注释在短暂延迟后显示翻译
- 已有的翻译不受影响
- 不会对用户编辑造成明显的性能影响

**验证方式**:
- 手动测试编辑 Java 文件
- 监控 CPU 和内存使用,确保性能可接受

#### 场景：Java 文件支持与配置保持一致

**前置条件**:
- 用户已在 VSCode 设置中配置目标语言为中文(`codei18n.targetLanguage: zh-CN`)

**操作步骤**:
1. 打开包含英文注释的 Java 文件
2. 扩展读取配置并传递给 CLI

**预期结果**:
- Java 注释翻译为配置的目标语言(如中文)
- 切换目标语言配置后,重新打开文件显示新语言的翻译

**验证方式**:
- 测试不同 `targetLanguage` 配置值
- 验证翻译结果符合预期语言

---

### 需求：扩展支持 Kotlin 语言的注释翻译

该需求规定 CodeI18n VSCode 扩展必须支持 Kotlin 语言(`.kt` 文件)的注释自动翻译,功能行为与 Java 保持一致。

**理由**  
- Kotlin 是 Android 开发的官方首选语言,在 JVM 生态中使用广泛
- CodeI18n CLI 已支持 Kotlin 的注释解析
- Kotlin 与 Java 共享相似的注释语法(`//` 和 `/* */`)

#### 场景:开发者打开 Kotlin 文件时自动显示注释翻译

**前置条件**:
- CodeI18n 扩展已安装并启用
- 工作区已初始化 CodeI18n 配置

**操作步骤**:
1. 用户在 VSCode 中打开一个 `.kt` 文件
2. 扩展检测到文件语言为 `kotlin`
3. 扩展调用 CLI 扫描 Kotlin 注释

**预期结果**:
- Kotlin 文件中的行注释(`//`)和块注释(`/* */`)被正确翻译
- 文档注释(`/** */`)被正确处理
- Hover 功能对 Kotlin 文件生效

**验证方式**:
- 创建包含各种注释类型的 Kotlin 测试文件
- 验证所有注释类型都能正确翻译和显示

#### 场景:Kotlin 文件的语言 ID 识别

**前置条件**:
- VSCode 已安装 Kotlin 语言支持插件(或 VSCode 内置支持)

**操作步骤**:
1. 创建 `.kt` 文件
2. 检查 `document.languageId`

**预期结果**:
- VSCode 将文件识别为 `kotlin` 语言 ID
- CodeI18n 扩展的语言白名单包含 `kotlin`

**验证方式**:
- 单元测试验证语言列表包含 `'kotlin'`
- 集成测试验证实际文件识别

---

### 需求:扩展支持 Scala 语言的注释翻译

该需求规定 CodeI18n VSCode 扩展必须支持 Scala 语言(`.scala` 文件)的注释自动翻译,功能行为与 Java、Kotlin 保持一致。

**理由**  
- Scala 在大数据和函数式编程领域广泛使用
- CodeI18n CLI 已支持 Scala 的注释解析
- Scala 使用与 Java 相同的注释语法

#### 场景:开发者打开 Scala 文件时自动显示注释翻译

**前置条件**:
- CodeI18n 扩展已安装并启用
- 工作区已初始化 CodeI18n 配置

**操作步骤**:
1. 用户在 VSCode 中打开一个 `.scala` 文件
2. 扩展检测到文件语言为 `scala`
3. 扩展调用 CLI 扫描 Scala 注释

**预期结果**:
- Scala 文件中的行注释(`//`)和文档注释(`/** */`)被正确翻译
- ScalaDoc 格式的注释被正确处理
- Hover 功能对 Scala 文件生效

**验证方式**:
- 创建包含 ScalaDoc 的测试文件
- 验证翻译和原文查看功能

#### 场景:Scala 文件的语言 ID 识别

**前置条件**:
- VSCode 已安装 Scala 语言支持插件(如 Metals)

**操作步骤**:
1. 创建 `.scala` 文件
2. 检查 `document.languageId`

**预期结果**:
- VSCode 将文件识别为 `scala` 语言 ID
- CodeI18n 扩展的语言白名单包含 `scala`

**验证方式**:
- 单元测试验证语言列表包含 `'scala'`
- 集成测试验证实际文件识别

---

### 需求:在文档中明确说明 Java 语言系列支持

该需求规定必须更新用户文档(`README.md`),明确列出对 Java、Kotlin、Scala 的支持,并提供使用示例。

**理由**  
- 用户需要知道扩展支持哪些编程语言
- 清晰的文档能够提高用户采用率和满意度

#### 场景:用户查看 README 了解支持的语言

**前置条件**:
- 用户访问项目 README 或 VSCode 扩展市场页面

**操作步骤**:
1. 用户浏览 "Supported Languages" 部分

**预期结果**:
- 文档中列出 Java、Kotlin、Scala 及其支持的注释类型
- 提供示例代码片段展示如何使用

**验证方式**:
- 审查 README 内容完整性
- 确保示例准确可运行

#### 场景:用户查看 CHANGELOG 了解版本变更

**前置条件**:
- 用户希望了解新版本的功能变化

**操作步骤**:
1. 用户打开 `CHANGELOG.md`

**预期结果**:
- CHANGELOG 中有明确的版本号和日期
- 说明新增了 Java、Kotlin、Scala 语言支持

**验证方式**:
- 确保 CHANGELOG 条目格式一致
- 版本号遵循语义化版本规范

---

## 边界条件与约束

### 边界条件
1. **混合语言项目**: 如果工作区包含多种语言文件,扩展应为每种支持的语言独立工作
2. **无 CLI 环境**: 如果 `codei18n` CLI 不可用,扩展应优雅降级(显示警告,不崩溃)
3. **大文件性能**: 对于包含数千行注释的大型 Java 文件,应确保扫描和渲染性能可接受

### 约束
1. **不修改 CLI**: 本功能完全依赖现有 CLI 能力,不对 CLI 进行任何修改
2. **保持架构一致**: 语言支持通过配置和列表扩展,不引入特殊的 Java 专用逻辑
3. **向后兼容**: 对现有语言(Go/Rust/JS/TS)的行为无任何影响

---

## 相关功能引用

本功能与以下现有功能保持一致:
- **JavaScript/TypeScript 支持** (`add-js-ts-comment-support`): 采用相同的扩展模式
- **Rust 支持** (0.2.0 版本): 参考其 Hover Provider 注册方式
- **CodeI18n 侧边栏** (`add-codei18n-activity-view`): 新语言文件在侧边栏中同样可见和操作

---

## 非功能需求

### 性能
- Java/Kotlin/Scala 文件的注释扫描延迟应与 Go/Rust 相当(通常<500ms)
- 大文件(>2000行)应避免 UI 阻塞

### 兼容性
- 兼容 VSCode `^1.74.0` 及更高版本
- 兼容当前版本的 CodeI18n CLI(dev 及后续稳定版本)

### 可测试性
- 每种语言至少有一个自动化测试用例
- 测试应覆盖语言识别、注释扫描和 Hover 功能

### 可维护性
- 语言列表应集中定义,避免硬编码分散
- 新增语言的代码变更应最小化,遵循 DRY 原则
