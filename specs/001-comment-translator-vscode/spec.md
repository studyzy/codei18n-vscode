# 功能规范: VSCode Comments Translator

**功能分支**: `001-comment-translator-vscode`
**创建时间**: 2025-12-16
**状态**: 草稿
**输入**: 用户描述: "请先阅读../codei18n/readme.md和../codei18n/docs对整体项目有个基本了解，而本项目是整体项目中的一部分，是VSCode的插件，通过该插件打开源码时（目前只支持Go）如果注释是英文的，会展示为对应的中文，然后鼠标放到中文注释上才会显示真正的英文注释。"

## 用户场景与测试 *(必填)*

### 用户故事 1 - 自动显示中文注释 (优先级: P1)

用户打开一个包含英文注释的 Go 源代码文件时，插件自动识别这些注释，并将其直观地显示为中文。这允许非英语母语的开发者在不修改源代码的情况下，更流畅地阅读和理解代码逻辑。

**优先级原因**: 这是插件的核心价值主张——消除语言障碍，提供即时的本地化阅读体验。没有此功能，插件将无法满足用户的基本需求。

**独立测试**: 
- 准备一个包含标准 Go 英文注释（单行 `//` 和多行 `/* */`）的文件。
- 启动插件并打开该文件。
- 验证所有英文注释在视觉上已被替换或覆盖为中文翻译。
- 验证磁盘上的文件内容未被修改（仍为英文）。

**验收场景**:

1. **给定** 一个包含英文注释 `// This is a test function` 的 Go 文件，且已配置中文翻译，
   **当** 用户在 VSCode 中打开该文件时，
   **那么** 编辑器中该行应显示为 `// 这是一个测试函数`（视觉效果）。

2. **给定** 一个包含多行英文注释的 Go 文件，
   **当** 用户打开文件时，
   **那么** 整个注释块应显示为对应的中文翻译。

3. **给定** 一个没有对应翻译的英文注释，
   **当** 用户打开文件时，
   **那么** 该注释应保持原样显示（英文）。

---

### 用户故事 2 - 悬停查看原文 (优先级: P1)

当用户将鼠标悬停在已经被“翻译”显示的中文注释上时，会弹出一个悬停窗口（Hover），显示原始的英文注释内容。这确保了开发者在需要确认原始含义或核对翻译准确性时，能够轻松访问原文。

**优先级原因**: 翻译可能存在误差，或者开发者需要引用原始英文术语。保留查看原文的能力对于准确理解代码至关重要，也是用户描述中明确要求的功能。

**独立测试**:
- 在已显示中文注释的编辑器中，将鼠标移动到中文文本上。
- 验证是否出现悬停提示框。
- 验证提示框内容是否包含原始的英文注释。

**验收场景**:

1. **给定** 编辑器中显示着中文注释 `// 这是一个测试函数`（原文为 `// This is a test function`），
   **当** 用户将鼠标悬停在该中文注释上时，
   **那么** 应显示一个包含 `This is a test function` 的悬停窗口。

---

### 边界情况

- **当** Go 文件中包含混合语言注释（部分中文，部分英文）时，系统应仅翻译/替换英文部分，或者是忽略已是中文的部分。
- **当** 打开非 Go 语言文件（如 Python 或 Java）时，插件应不进行任何操作（目前只支持 Go）。
- **当** 翻译映射文件丢失或损坏时，系统应优雅降级，显示原始英文注释，可能在输出面板记录警告，但不应报错弹窗打扰用户。
- **当** 注释包含特殊字符或代码片段（如 `// Returns true if x > 0`）时，翻译显示不应破坏代码片段的格式或含义。

## 需求 *(必填)*

### 功能需求

- **FR-001**: 系统必须能够解析当前打开的 Go 语言源代码文件，识别其中的注释块（单行和多行）。
- **FR-002**: 系统必须利用 `../codei18n` 提供的核心逻辑或数据源（如映射文件），根据注释内容的哈希（ID）查找对应的中文翻译。
- **FR-003**: 系统必须在编辑器视图中将英文注释的文本视觉上替换为中文翻译。
  - *注意*: 这必须是视觉上的展示层替换，**严禁**修改磁盘上的文件内容或编辑器缓冲区中的实际文本。
- **FR-004**: 系统必须在用户将鼠标悬停在被替换的注释区域时，提供包含原始英文内容的悬停提示框。
- **FR-005**: 系统必须仅对 Go 语言文件（`.go`）激活此功能。
- **FR-006**: 系统必须处理翻译缺失的情况：如果找不到对应的翻译，则保持原样显示。

### 关键实体 *(如果功能涉及数据则包含)*

- **Comment (注释)**: 代表源代码中的一段注释，包含其位置（Range）、原始内容（英文）和计算出的唯一 ID。
- **Translation (翻译)**: 对应于特定 Comment ID 的本地化文本（中文）。
- **TranslationMap (翻译映射)**: 存储 ID 到 Translation 映射关系的数据结构/文件，由 `codei18n` 核心维护。

## 成功标准 *(必填)*

### 可衡量的结果

- **SC-001**: 用户打开一个 500 行以内的 Go 文件，注释翻译的渲染延迟应小于 500ms（即“瞬间”感觉）。
- **SC-002**: 在 100% 的测试用例中，磁盘上的源文件在插件运行期间和之后均保持未修改状态（MD5哈希值不变）。
- **SC-003**: 悬停在中文注释上时，悬停提示框在 200ms 内出现并显示正确的英文原文。
- **SC-004**: 系统能够正确处理并翻译标准 Go 库中常见的注释格式（如 `// Package fmt implements...`）。
